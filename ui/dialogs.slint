import { Button, VerticalBox, HorizontalBox, ComboBox, ScrollView } from "std-widgets.slint";
import { Theme } from "theme.slint";

export struct FondsSchemaOption {
    code: string,
    name: string,
}

// ============================================================================
// Custom Button Component with Theme Colors
// ============================================================================

export component ThemedButton inherits Rectangle {
    in property <string> text: "";
    in property <bool> is_primary: false;
    in property <bool> enabled: true;
    
    callback clicked <=> touch.clicked;
    
    width: 80px;
    height: 32px;
    border-radius: 4px;
    opacity: enabled ? 1.0 : 0.5;
    background: enabled ? (
        is_primary ?
            (touch.has-hover ? Theme.brand_secondary : Theme.brand_primary) :
            (touch.has-hover ? Theme.bg_elevated : Theme.bg_alt)
    ) : Theme.bg_alt;
    
    Text {
        text: root.text;
        color: root.enabled ?
            (is_primary ? Theme.text_on_brand : Theme.brand_primary) :
            #666;
        font-size: 13px;
        font-family: "Microsoft YaHei";
        horizontal-alignment: center;
        vertical-alignment: center;
    }
    
    touch := TouchArea {
        enabled: root.enabled;
    }
}

// ============================================================================
// Unified Dialog Buttons Component
// ============================================================================

export component DialogButtons inherits HorizontalBox {
    in property <int> current_language: 0;
    in property <bool> confirm_enabled: true;
    
    callback confirm();
    callback cancel();
    
    spacing: 10px;
    alignment: end;
    
    ThemedButton {
        text: @tr("btn_cancel");
        is_primary: false;
        clicked => {
            root.cancel();
        }
    }
    
    ThemedButton {
        text: @tr("btn_confirm");
        is_primary: true;
        enabled: root.confirm_enabled;
        clicked => {
            root.confirm();
        }
    }
}

// ============================================================================
// Schema Input Dialog Component
// ============================================================================

export component SchemaInputDialog inherits Window {
    // Language property (0: Chinese, 1: English)
    in property <int> current_language: 0;
    
    title: @tr("dialog_add_schema_title");
    width: 400px;
    height: 220px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;
    
    in-out property <string> schema_code_input: "";
    in-out property <string> schema_name_input: "";
    
    callback confirm_input(string, string);
    callback cancel_input();
    
    forward-focus: code-input;
    
    FocusScope {
        key-pressed(event) => {
            if event.text == Key.Escape {
                root.cancel_input();
                return accept;
            }
            return reject;
        }
        
        VerticalBox {
            padding-left: 10px;
            padding-right: 10px;
            padding-top: 15px;
            padding-bottom: 30px;
            spacing: 8px;
            
            VerticalBox {
                spacing: 8px;
        
                // Code input (horizontal layout)
                HorizontalBox {
                    spacing: 8px;
                    
                    Text {
                        text: @tr("label_code");
                        font-size: 13px;
                        font-family: "Microsoft YaHei";
                        width: 45px;
                        vertical-alignment: center;
                    }
                    
                    Rectangle {
                        border-color: Theme.nav_border;
                        border-width: 1px;
                        border-radius: 3px;
                        background: white;
                        height: 32px;
                        
                        code-input := TextInput {
                            text <=> root.schema_code_input;
                            font-family: "Microsoft YaHei";
                            font-size: 13px;
                            vertical-alignment: center;
                            width: 100%;
                            height: 100%;
                        }
                    }
                }
                
                // Name input (horizontal layout)
                HorizontalBox {
                    spacing: 8px;
                    
                    Text {
                        text: @tr("label_name");
                        font-size: 13px;
                        font-family: "Microsoft YaHei";
                        width: 45px;
                        vertical-alignment: center;
                    }
                    
                    Rectangle {
                        border-color: Theme.nav_border;
                        border-width: 1px;
                        border-radius: 3px;
                        background: white;
                        height: 32px;
                        
                        TextInput {
                            text <=> root.schema_name_input;
                            font-family: "Microsoft YaHei";
                            font-size: 13px;
                            vertical-alignment: center;
                            width: 100%;
                            height: 100%;
                        }
                    }
                }
            }
        
            // Buttons
            DialogButtons {
                current_language: root.current_language;
                confirm => {
                    root.confirm_input(root.schema_code_input, root.schema_name_input);
                }
                cancel => {
                    root.cancel_input();
                }
            }
        }
    }
}

// ============================================================================
// Rename Archive Library Dialog Component
// ============================================================================

// ============================================================================

export component RenameArchiveDialog inherits Window {
    // Language property (0: Chinese, 1: English)
    in property <int> current_language: 0;
    
    title: @tr("dialog_rename_archive_title");
    width: 400px;
    height: 180px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;
    
    in-out property <string> library_name_input: "";
    
    callback confirm_input(string);
    callback cancel_input();
    
    VerticalBox {
        padding-left: 10px;
        padding-right: 10px;
        padding-top: 15px;
        padding-bottom: 30px;
        spacing: 8px;
        
        VerticalBox {
            spacing: 8px;
    
            // Name input (horizontal layout)
            HorizontalBox {
                spacing: 8px;
                
                Text {
                    text: @tr("label_name");
                    font-size: 13px;
                    font-family: "Microsoft YaHei";
                    width: 45px;
                    vertical-alignment: center;
                }
                
                Rectangle {
                    border-color: Theme.nav_border;
                    border-width: 1px;
                    border-radius: 3px;
                    background: white;
                    height: 32px;
                    
                    TextInput {
                        text <=> root.library_name_input;
                        font-family: "Microsoft YaHei";
                        font-size: 13px;
                        vertical-alignment: center;
                        width: 100%;
                        height: 100%;
                    }
                }
            }
        }
    
        // Buttons
        DialogButtons {
            current_language: root.current_language;
            confirm => {
                root.confirm_input(root.library_name_input);
            }
            cancel => {
                root.cancel_input();
            }
        }
    }
}

// ============================================================================
// File Input Dialog Component
// ============================================================================

export component FileInputDialog inherits Window {
    in property <int> current_language: 0;
    title: @tr("dialog_add_file_title");
    width: 400px;
    height: 180px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;

    in-out property <string> file_name_input: "";

    callback confirm_input(string);
    callback cancel_input();

    forward-focus: file-name-input;

    FocusScope {
        key-pressed(event) => {
            if event.text == Key.Escape {
                root.cancel_input();
                return accept;
            }
            return reject;
        }

        VerticalBox {
            padding-left: 10px;
            padding-right: 10px;
            padding-top: 15px;
            padding-bottom: 30px;
            spacing: 8px;

            VerticalBox { spacing: 8px;
                HorizontalBox { spacing: 8px;
                    Text { text: @tr("label_name"); font-size: 13px; font-family: "Microsoft YaHei"; width: 45px; vertical-alignment: center; }
                    Rectangle { border-color: Theme.nav_border; border-width: 1px; border-radius: 3px; background: white; height: 32px;
                        file-name-input := TextInput { text <=> root.file_name_input; font-family: "Microsoft YaHei"; font-size: 13px; vertical-alignment: center; width: 100%; height: 100%; }
                    }
                }
            }

            DialogButtons {
                current_language: root.current_language;
                confirm => {
                    root.confirm_input(root.file_name_input);
                }
                cancel => {
                    root.cancel_input();
                }
            }
        }
    }
}

// ============================================================================
// Schema Item Input Dialog Component
// ============================================================================

export component SchemaItemInputDialog inherits Window {
    // Language property (0: Chinese, 1: English)
    in property <int> current_language: 0;
    
    title: @tr("dialog_add_schema_item_title");
    width: 400px;
    height: 220px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;
    
    in-out property <string> item_code_input: "";
    in-out property <string> item_name_input: "";
    
    callback confirm_input(string, string);
    callback cancel_input();
    
    VerticalBox {
        padding-left: 10px;
        padding-right: 10px;
        padding-top: 15px;
        padding-bottom: 30px;
        spacing: 8px;
        
        VerticalBox {
            spacing: 8px;
    
            // Code input (horizontal layout)
            HorizontalBox {
                spacing: 8px;
                
                Text {
                    text: @tr("label_code");
                    font-size: 13px;
                    font-family: "Microsoft YaHei";
                    width: 45px;
                    vertical-alignment: center;
                }                    Rectangle {
                        border-color: Theme.nav_border;
                        border-width: 1px;
                        border-radius: 3px;
                        background: white;
                        height: 32px;
                        
                        item-code-input := TextInput {
                            text <=> root.item_code_input;
                            font-family: "Microsoft YaHei";
                            font-size: 13px;
                            vertical-alignment: center;
                            width: 100%;
                            height: 100%;
                        }
                    }
                }
        
                // Name input (horizontal layout)
                HorizontalBox {
                    spacing: 8px;
                    
                    Text {
                        text: @tr("label_name");
                        font-size: 13px;
                        font-family: "Microsoft YaHei";
                        width: 45px;
                        vertical-alignment: center;
                    }
                    
                    Rectangle {
                        border-color: Theme.nav_border;
                        border-width: 1px;
                        border-radius: 3px;
                        background: white;
                        height: 32px;
                        
                        TextInput {
                            text <=> root.item_name_input;
                            font-family: "Microsoft YaHei";
                            font-size: 13px;
                            vertical-alignment: center;
                            width: 100%;
                            height: 100%;
                        }
                    }
                }
            }
        
        // Buttons
        DialogButtons {
            current_language: root.current_language;
            confirm => {
                root.confirm_input(root.item_code_input, root.item_name_input);
            }
            cancel => {
                root.cancel_input();
            }
        }
    }
}

// ============================================================================
// Confirmation Dialog Component
// ============================================================================

export component ConfirmDialog inherits Window {
    // Language property (0: Chinese, 1: English)
    in property <int> current_language: 0;
    in property <string> message: "";
    
    title: @tr("dialog_confirm_title");
    width: 400px;
    height: 180px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;
    
    callback confirm();
    callback cancel();
    
    FocusScope {
        key-pressed(event) => {
            if event.text == Key.Escape {
                root.cancel();
                return accept;
            }
            return reject;
        }
        
        VerticalBox {
            padding-left: 20px;
            padding-right: 20px;
            padding-top: 20px;
            padding-bottom: 30px;
            spacing: 15px;
        
            VerticalBox {
                // Message text
                Text {
                    text: root.message;
                    font-size: 14px;
                    font-family: "Microsoft YaHei";
                    color: Theme.text_primary;
                    wrap: word-wrap;
                    horizontal-alignment: center;
                }
            }
        
            // Buttons
            HorizontalBox {
                spacing: 10px;
                alignment: center;
            
            DialogButtons {
                current_language: root.current_language;
                confirm => {
                    root.confirm();
                }
                cancel => {
                    root.cancel();
                }
            }
            }
        }
    }
}

// ============================================================================
// Classification Input Dialog (Top Level)
// ============================================================================

export component ClassificationInputDialog inherits Window {
    in property <int> current_language: 0;
    title: @tr("dialog_add_classification_title");
    width: 400px;
    height: 220px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;

    in-out property <string> classification_code_input: "";
    in-out property <string> classification_name_input: "";

    callback confirm_input(string, string);
    callback cancel_input();

    forward-focus: classification-code-input;

    FocusScope {
        key-pressed(event) => {
            if event.text == Key.Escape {
                root.cancel_input();
                return accept;
            }
            return reject;
        }

        VerticalBox {
            padding-left: 10px;
            padding-right: 10px;
            padding-top: 15px;
            padding-bottom: 30px;
            spacing: 8px;

            VerticalBox { spacing: 8px;
                HorizontalBox { spacing: 8px;
                    Text { text: @tr("label_code"); font-size: 13px; font-family: "Microsoft YaHei"; width: 45px; vertical-alignment: center; }
                    Rectangle { border-color: Theme.nav_border; border-width: 1px; border-radius: 3px; background: white; height: 32px;
                        classification-code-input := TextInput { text <=> root.classification_code_input; font-family: "Microsoft YaHei"; font-size: 13px; vertical-alignment: center; width: 100%; height: 100%; }
                    }
                }
                HorizontalBox { spacing: 8px;
                    Text { text: @tr("label_name"); font-size: 13px; font-family: "Microsoft YaHei"; width: 45px; vertical-alignment: center; }
                    Rectangle { border-color: Theme.nav_border; border-width: 1px; border-radius: 3px; background: white; height: 32px;
                        TextInput { text <=> root.classification_name_input; font-family: "Microsoft YaHei"; font-size: 13px; vertical-alignment: center; width: 100%; height: 100%; }
                    }
                }
            }

            DialogButtons {
                current_language: root.current_language;
                confirm => {
                    root.confirm_input(root.classification_code_input, root.classification_name_input);
                }
                cancel => {
                    root.cancel_input();
                }
            }
        }
    }
}

// ============================================================================
// Child Classification Input Dialog (Second Level)
// ============================================================================

export component ClassificationChildInputDialog inherits Window {
    in property <int> current_language: 0;
    in property <string> parent_display: ""; // e.g., parent code-name for context
    title: @tr("dialog_add_child_classification_title");
    width: 400px;
    height: 250px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;

    in-out property <string> child_code_input: "";
    in-out property <string> child_name_input: "";

    callback confirm_input(string, string);
    callback cancel_input();

    forward-focus: child-code-input;

    FocusScope {
        key-pressed(event) => {
            if event.text == Key.Escape {
                root.cancel_input();
                return accept;
            }
            return reject;
        }

        VerticalBox {
            padding-left: 10px;
            padding-right: 10px;
            padding-top: 15px;
            padding-bottom: 30px;
            spacing: 8px;

            // Parent context display
            Rectangle { height: 34px; background: Theme.bg_alt; border-radius: 4px; border-width: 1px; border-color: Theme.nav_border;
                Text { text: @tr("label_parent") + " " + root.parent_display; font-size: 12px; horizontal-alignment: center; vertical-alignment: center; color: Theme.text_primary; }
            }

            VerticalBox { spacing: 8px;
                HorizontalBox { spacing: 8px;
                    Text { text: @tr("label_code"); font-size: 13px; font-family: "Microsoft YaHei"; width: 45px; vertical-alignment: center; }
                    Rectangle { border-color: Theme.nav_border; border-width: 1px; border-radius: 3px; background: white; height: 32px;
                        child-code-input := TextInput { text <=> root.child_code_input; font-family: "Microsoft YaHei"; font-size: 13px; vertical-alignment: center; width: 100%; height: 100%; }
                    }
                }
                HorizontalBox { spacing: 8px;
                    Text { text: @tr("label_name"); font-size: 13px; font-family: "Microsoft YaHei"; width: 45px; vertical-alignment: center; }
                    Rectangle { border-color: Theme.nav_border; border-width: 1px; border-radius: 3px; background: white; height: 32px;
                        TextInput { text <=> root.child_name_input; font-family: "Microsoft YaHei"; font-size: 13px; vertical-alignment: center; width: 100%; height: 100%; }
                    }
                }
            }

            DialogButtons {
                current_language: root.current_language;
                confirm => {
                    root.confirm_input(root.child_code_input, root.child_name_input);
                }
                cancel => {
                    root.cancel_input();
                }
            }
        }
    }
}

// ============================================================================
// Add Fonds Dialog with Draggable Window & Schema Transfer UI
// ============================================================================

export component AddFondsDialog inherits Window {
    in property <int> current_language: 0;
    title: @tr("dialog_add_fonds_title");
    width: 720px;
    height: 620px;
    background: Theme.bg_primary;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;

    in-out property <string> fonds_name_input: "";
    in-out property <[string]> primary_classifications: ["Ë°åÊîøÁÆ°ÁêÜÁ±ª", "‰∏öÂä°ÁÆ°ÁêÜÁ±ª", "ÁªºÂêàÁ±ª"];
    in-out property <[[string]]> secondary_classifications: [
        ["‰∫∫‰∫ãÁÆ°ÁêÜ", "ÁªºÂêàÊ≤ªÁêÜ", "ÂêéÂã§‰øùÈöú"],
        ["Ë¥¢Âä°‰ºöËÆ°", "ÂÆ°ËÆ°ÁõëÁù£", "‰∏öÂä°ÊåáÂØº"],
        ["È°πÁõÆÁÆ°ÁêÜ", "ÊàêÊûúÊ±áÁºñ"]
    ];
    in-out property <int> selected_primary_classification: 0;
    in-out property <int> selected_secondary_classification: 0;

    in-out property <[FondsSchemaOption]> available_schema_items: [
        { code: "YEAR", name: "Âπ¥Â∫¶" },
        { code: "DEPT", name: "ÈÉ®Èó®" },
        { code: "TYPE", name: "Á±ªÂà´" },
        { code: "MEDIA", name: "ËΩΩ‰Ωì" },
        { code: "LEVEL", name: "ÂØÜÁ∫ß" }
    ];
    in-out property <[FondsSchemaOption]> chosen_schema_items: [];
    in-out property <int> highlighted_available_schema: -1;
    in-out property <int> highlighted_chosen_schema: -1;

    callback confirm();
    callback cancel();
    callback move_schema_to_selected(int);
    callback move_schema_back(int);

    property <bool> can_move_right: root.highlighted_available_schema >= 0;
    property <bool> can_move_left: root.highlighted_chosen_schema >= 0;

    FocusScope {
        key-pressed(event) => {
            if event.text == Key.Escape {
                root.cancel();
                return accept;
            }
            return reject;
        }

        VerticalBox {
            padding-left: 20px;
            padding-right: 20px;
            padding-top: 20px;
            padding-bottom: 24px;
            spacing: 16px;

            // First row inputs
            HorizontalBox {
                spacing: 12px;
                alignment: stretch;

                VerticalBox {
                    horizontal-stretch: 1;
                    spacing: 6px;

                    Text {
                        text: @tr("label_fonds_name");
                        font-size: 13px;
                        color: #666;
                    }

                    Rectangle {
                        height: 36px;
                        border-width: 1px;
                        border-color: Theme.nav_border;
                        border-radius: 4px;
                        background: white;

                        TextInput {
                            text <=> root.fonds_name_input;
                            font-size: 13px;
                            vertical-alignment: center;
                            width: 100%;
                            height: 100%;
                        }
                    }
                }

                VerticalBox {
                    horizontal-stretch: 1;
                    spacing: 6px;

                    Text {
                        text: @tr("label_primary_classification");
                        font-size: 13px;
                        color: #666;
                    }

                    Rectangle {
                        height: 36px;
                        border-width: 1px;
                        border-color: Theme.nav_border;
                        border-radius: 4px;
                        background: white;

                        ComboBox {
                            width: 100%;
                            height: 100%;
                            model: root.primary_classifications;
                            current-index <=> root.selected_primary_classification;
                        }
                    }
                }

                VerticalBox {
                    horizontal-stretch: 1;
                    spacing: 6px;

                    Text {
                        text: @tr("label_secondary_classification");
                        font-size: 13px;
                        color: #666;
                    }

                    Rectangle {
                        height: 36px;
                        border-width: 1px;
                        border-color: Theme.nav_border;
                        border-radius: 4px;
                        background: white;

                        ComboBox {
                            width: 100%;
                            height: 100%;
                            model: root.secondary_classifications.length > 0 ?
                                root.secondary_classifications[Math.min(root.selected_primary_classification, root.secondary_classifications.length - 1)] :
                                [];
                            current-index <=> root.selected_secondary_classification;
                        }
                    }
                }
            }

            // Schema transfer box
            VerticalBox {
                spacing: 8px;

                Text {
                    text: @tr("label_select_schemas");
                    font-size: 13px;
                    font-weight: 600;
                    color: Theme.text_primary;
                }

                HorizontalBox {
                    spacing: 12px;
                    height: 320px;

                    // Available list
                    Rectangle {
                        horizontal-stretch: 1;
                        border-width: 1px;
                        border-color: Theme.nav_border;
                        border-radius: 6px;
                        background: Theme.bg_alt;
                        padding: 0px;

                        VerticalBox {
                            padding: 12px;
                            spacing: 12px;

                            Text {
                                text: @tr("label_available_schemas");
                                font-size: 12px;
                                color: #666;
                            }

                            ScrollView {
                                VerticalBox {
                                    spacing: 6px;

                                    for schema_item[index] in root.available_schema_items : Rectangle {
                                        height: 48px;
                                        border-width: 1px;
                                        border-color: root.highlighted_available_schema == index ? Theme.brand_primary : Theme.nav_border;
                                        border-radius: 4px;
                                        background: root.highlighted_available_schema == index ? Theme.brand_soft : white;

                                        VerticalBox {
                                            padding-left: 10px;
                                            padding-right: 10px;
                                            padding-top: 6px;
                                            padding-bottom: 6px;
                                            spacing: 2px;

                                            Text { text: schema_item.code; font-weight: 600; font-size: 13px; color: Theme.text_primary; }
                                            Text { text: schema_item.name; font-size: 12px; color: #666; }
                                        }

                                        TouchArea {
                                            clicked => {
                                                root.highlighted_available_schema = index;
                                                root.highlighted_chosen_schema = -1;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }

                    // Transfer buttons
                    VerticalBox {
                        width: 80px;
                        spacing: 16px;
                        alignment: center;

                        ThemedButton {
                            text: ">>";
                            is_primary: true;
                            width: 64px;
                            enabled: root.can_move_right;
                            clicked => {
                                if root.can_move_right {
                                    root.move_schema_to_selected(root.highlighted_available_schema);
                                }
                            }
                        }

                        ThemedButton {
                            text: "<<";
                            is_primary: false;
                            width: 64px;
                            enabled: root.can_move_left;
                            clicked => {
                                if root.can_move_left {
                                    root.move_schema_back(root.highlighted_chosen_schema);
                                }
                            }
                        }
                    }

                    // Selected list
                    Rectangle {
                        horizontal-stretch: 1;
                        border-width: 1px;
                        border-color: Theme.nav_border;
                        border-radius: 6px;
                        background: Theme.bg_alt;

                        VerticalBox {
                            padding: 12px;
                            spacing: 12px;

                            Text {
                                text: @tr("label_selected_schemas");
                                font-size: 12px;
                                color: #666;
                            }

                            ScrollView {
                                VerticalBox {
                                    spacing: 6px;

                                    for schema_item[index] in root.chosen_schema_items : Rectangle {
                                        height: 48px;
                                        border-width: 1px;
                                        border-color: root.highlighted_chosen_schema == index ? Theme.brand_primary : Theme.nav_border;
                                        border-radius: 4px;
                                        background: root.highlighted_chosen_schema == index ? Theme.brand_soft : white;

                                        VerticalBox {
                                            padding-left: 10px;
                                            padding-right: 10px;
                                            padding-top: 6px;
                                            padding-bottom: 6px;
                                            spacing: 2px;

                                            Text { text: schema_item.code; font-weight: 600; font-size: 13px; color: Theme.text_primary; }
                                            Text { text: schema_item.name; font-size: 12px; color: #666; }
                                        }

                                        TouchArea {
                                            clicked => {
                                                root.highlighted_chosen_schema = index;
                                                root.highlighted_available_schema = -1;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            // Footer buttons
            DialogButtons {
                current_language: root.current_language;
                confirm => {
                    root.confirm();
                }
                cancel => {
                    root.cancel();
                }
            }
        }
    }
}

// ============================================================================
// Add Item Dialog - for adding new items to files
// ============================================================================

export component AddItemDialog inherits Window {
    in property <int> current_language: 0;
    in property <string> file_base_path: "";  // Base path for file selection restriction
    
    in-out property <string> item_name_input: "";
    in-out property <string> selected_file_path: "";
    
    callback confirm_input(string, string);
    callback cancel_input();
    callback browse_file();
    
    title: @tr("add_item");
    width: 400px;
    height: 220px;
    default-font-family: "Microsoft YaHei";
    default-font-size: 14px;
    
    forward-focus: item-name-input;
    
    FocusScope {
        key-pressed(event) => {
            if event.text == Key.Escape {
                root.cancel_input();
                return accept;
            }
            return reject;
        }
        
        VerticalBox {
            padding-left: 10px;
            padding-right: 10px;
            padding-top: 15px;
            padding-bottom: 30px;
            spacing: 8px;
            
            VerticalBox {
                spacing: 8px;
                
                // Item name input
                HorizontalBox {
                    spacing: 8px;
                    
                    Text {
                        text: @tr("label_name");
                        font-size: 13px;
                        font-family: "Microsoft YaHei";
                        width: 45px;
                        vertical-alignment: center;
                    }
                    
                    Rectangle {
                        border-color: Theme.nav_border;
                        border-width: 1px;
                        border-radius: 3px;
                        background: white;
                        height: 32px;
                        
                        item-name-input := TextInput {
                            text <=> root.item_name_input;
                            font-family: "Microsoft YaHei";
                            font-size: 13px;
                            vertical-alignment: center;
                            width: 100%;
                            height: 100%;
                        }
                    }
                }
                
                // File path selection
                HorizontalBox {
                    spacing: 8px;
                    
                    Text {
                        text: @tr("label_path");
                        font-size: 13px;
                        font-family: "Microsoft YaHei";
                        width: 45px;
                        vertical-alignment: center;
                    }
                    
                    Rectangle {
                        horizontal-stretch: 1;
                        border-color: Theme.nav_border;
                        border-width: 1px;
                        border-radius: 3px;
                        background: #f5f5f5;
                        height: 32px;
                        
                        HorizontalBox {
                            padding-left: 8px;
                            padding-right: 4px;
                            
                            Text {
                                horizontal-stretch: 1;
                                text: root.selected_file_path != "" ? root.selected_file_path : @tr("no_file_selected");
                                font-size: 12px;
                                color: root.selected_file_path != "" ? Theme.text_primary : Theme.text_secondary;
                                overflow: elide;
                                vertical-alignment: center;
                            }
                            
                            Rectangle {
                                width: 28px;
                                height: 28px;
                                border-radius: 3px;
                                background: browse_touch.has-hover ? Theme.bg_alt : transparent;
                                
                                Text {
                                    text: "üìÇ";
                                    font-size: 16px;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }
                                
                                browse_touch := TouchArea {
                                    clicked => { root.browse_file(); }
                                }
                            }
                        }
                    }
                }
            }
            
            DialogButtons {
                current_language: root.current_language;
                confirm => {
                    if root.item_name_input != "" && root.selected_file_path != "" {
                        root.confirm_input(root.item_name_input, root.selected_file_path);
                    }
                }
                cancel => {
                    root.cancel_input();
                }
            }
        }
    }
}
