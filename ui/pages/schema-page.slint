import { VerticalBox, HorizontalBox } from "std-widgets.slint";
import { Theme, Layout } from "../theme.slint";
import { CrudList } from "../components/crud-list.slint";
import { CrudListItem, DialogField, DialogFieldType } from "../models.slint";
import { FormDialog } from "../components/dialogs.slint";

// ============================================================================
// Schema Page Component - MVVM Architecture
// ============================================================================
export component SchemaPage inherits Rectangle {
    // Schema list
    in property <[CrudListItem]> schema_list_items: [];

    // Schema item details
    in property <[CrudListItem]> detail_list_items: [];

    // Dialog states
    in-out property <bool> show_add_schema_dialog: false;
    in-out property <bool> show_add_schema_item_dialog: false;
    in-out property <[DialogField]> add_schema_fields: [
        { label: "label_code", field_type: DialogFieldType.text, value: "", placeholder: @tr("" => "placeholder_code") },
        { label: "label_name", field_type: DialogFieldType.text, value: "", placeholder: @tr("" => "placeholder_name") },
    ];
    in-out property <[DialogField]> add_schema_item_fields: [
        { label: "label_code", field_type: DialogFieldType.text, value: "", placeholder: @tr("" => "placeholder_code") },
        { label: "label_name", field_type: DialogFieldType.text, value: "", placeholder: @tr("" => "placeholder_name") },
    ];

    // Callbacks for schemas
    callback add_schema();
    callback delete_schema();
    callback schema_item_clicked(int);
    callback schema_activated(int);

    // Callbacks for schema items
    callback add_schema_item();
    callback delete_schema_item();
    callback schema_item_item_clicked(int);
    callback schema_item_activated(int);

    // Dialog callbacks
    callback confirm_add_schema([DialogField]);
    callback cancel_add_schema();
    callback confirm_add_schema_item([DialogField]);
    callback cancel_add_schema_item();

    background: transparent;

    HorizontalBox {
        width: 100%;
        height: 100%;
        spacing: 0px;

        VerticalBox {
            horizontal-stretch: 0.4;
            padding: Layout.standard_padding;
            spacing: Layout.standard_spacing;

            CrudList {
                vertical-stretch: 1;
                title: @tr("label_schema");
                items: root.schema_list_items;
                show-add-button: true;
                activate-first-on-load: true;

                add-clicked => { root.add_schema(); }
                item-clicked(index) => {
                    root.schema_item_clicked(index);
                }
                item-activated(index) => {
                    root.schema_activated(index);
                }
                delete-clicked => { root.delete_schema(); }
            }
        }

        Rectangle { width: Layout.separator_width; background: Theme.nav_border; }

        VerticalBox {
            horizontal-stretch: 0.6;
            padding: Layout.standard_padding;
            spacing: Layout.standard_spacing;

            CrudList {
                vertical-stretch: 1;
                title: @tr("label_items");
                items: root.detail_list_items;
                show-add-button: true;
                activate-first-on-load: false;

                add-clicked => { root.add_schema_item(); }
                item-clicked(index) => {
                    root.schema_item_item_clicked(index);
                }
                item-activated(index) => {
                    root.schema_item_activated(index);
                }
                delete-clicked => { root.delete_schema_item(); }
            }
        }
    }

    // Add Schema Dialog
    if root.show_add_schema_dialog : FormDialog {
        width: 100%;
        height: 100%;
        title: @tr("" => "dialog_add_schema");
        current_language: 0; // TODO: Get from settings
        fields: root.add_schema_fields;

        confirm(fields) => {
            root.confirm_add_schema(fields);
        }

        cancel => {
            root.cancel_add_schema();
        }

        browse_folder(index) => {
            // Not used for schema dialog
        }
    }

    // Add Schema Item Dialog
    if root.show_add_schema_item_dialog : FormDialog {
        width: 100%;
        height: 100%;
        title: @tr("" => "dialog_add_schema_item");
        current_language: 0; // TODO: Get from settings
        fields: root.add_schema_item_fields;

        confirm(fields) => {
            root.confirm_add_schema_item(fields);
        }

        cancel => {
            root.cancel_add_schema_item();
        }

        browse_folder(index) => {
            // Not used for schema item dialog
        }
    }
}