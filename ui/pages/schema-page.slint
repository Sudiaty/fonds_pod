import { VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";
import { Theme, Layout } from "../theme.slint";
import { SchemaItem, SchemaItemDetail, CrudListItem } from "../models.slint";
import { CrudList } from "../crud-list.slint";

export component SchemaPage inherits HorizontalBox {
    // Original data with specific types
    in property <[SchemaItem]> schema_items: [];
    in-out property <int> selected_schema: 0;
    in property <[int]> selected_schemas: [];

    in property <[SchemaItemDetail]> item_details: [];
    in-out property <int> selected_item: 0;
    in property <[int]> selected_items: [];

    // Converted data for CrudList (set from Rust backend)
    in property <[CrudListItem]> schema_list_items: [];
    in property <[CrudListItem]> detail_list_items: [];

    // Original callbacks
    callback add_schema();
    callback delete_schema();
    callback delete_selected_schemas();
    callback schema_item_clicked(int, bool, bool);
    callback schema_activated(int);

    callback add_schema_item();
    callback delete_schema_item();
    callback delete_selected_items();
    callback schema_item_item_clicked(int, bool, bool);
    callback schema_item_activated(int);

    spacing: 0px;

    // Left panel - Schema list
    CrudList {
        horizontal-stretch: 0.4;
        title: @tr("label_schema");
        items: root.schema_list_items;
        active-index <=> root.selected_schema;
        selected-indices: root.selected_schemas;
        activate-first-on-load: true;

        add-clicked => { root.add_schema(); }
        
        item-clicked(index, ctrl, shift) => {
            root.schema_item_clicked(index, ctrl, shift);
        }
        
        item-activated(index) => {
            root.schema_activated(index);
        }
        
        delete-clicked => { root.delete_schema(); }
        delete-selected-clicked => { root.delete_selected_schemas(); }
    }

    Rectangle { width: Layout.separator_width; background: Theme.nav_border; }

    // Right panel - Schema item details
    CrudList {
        horizontal-stretch: 0.6;
        title: @tr("label_items");
        items: root.detail_list_items;
        active-index <=> root.selected_item;
        selected-indices: root.selected_items;
        activate-first-on-load: false;

        add-clicked => { root.add_schema_item(); }
        
        item-clicked(index, ctrl, shift) => {
            root.schema_item_item_clicked(index, ctrl, shift);
        }
        
        item-activated(index) => {
            root.schema_item_activated(index);
        }
        
        delete-clicked => { root.delete_schema_item(); }
        delete-selected-clicked => { root.delete_selected_items(); }
    }
}

